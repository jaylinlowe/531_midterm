---
title: "ARIMA Analysis of Baby Average Vowel"
output: html_document
date: "2025-02-09"
---

```{r setup}
library(stringr)
library(dplyr)
library(babynames)
library(tseries)
library(forecast)
library(ggplot2)
```

## 1. Construct Weighted Average Vowel Count Data
```{r}
vowel_df2 <- babynames %>%
  mutate(num_vowels = str_count(name, '[aeoiuAEOIU]')) %>%
  mutate(num_vowels_people = num_vowels * n) %>%
  group_by(year, sex) %>%
  summarize(avg_num = sum(num_vowels_people)/sum(n), .groups = "drop")
```

## 2. Create Time Series for Males and Females (Frequency = 1, Yearly)
```{r}
male_ts <- ts(
  vowel_df2 %>% filter(sex == "M") %>% arrange(year) %>% pull(avg_num),
  start = min(vowel_df2$year),
  frequency = 1
)
female_ts <- ts(
  vowel_df2 %>% filter(sex == "F") %>% arrange(year) %>% pull(avg_num),
  start = min(vowel_df2$year),
  frequency = 1
)
```

## 3. Perform ADF Unit Root Test and Plot Original Series
```{r}
cat("Original Male Series ADF Test Result:\n")
adf_male_original <- adf.test(male_ts)
print(adf_male_original)

cat("\nOriginal Female Series ADF Test Result:\n")
adf_female_original <- adf.test(female_ts)
print(adf_female_original)
```

```{r}
ggplot(vowel_df2, aes(x = year, y = avg_num, color = sex)) + geom_line() + 
  labs(title = "Average Number of Vowels in Names Over Time", x = "Year", y = "Average Vowel Count") +
  theme_minimal()
```

## 4. Define Automatic Differencing Function
```{r}
auto_diff_adf <- function(ts_data, alpha = 0.05, max_diff = 3) {
  d <- 0
  ts_current <- ts_data
  adf_result <- adf.test(ts_current)
  while (adf_result$p.value > alpha && d < max_diff) {
    d <- d + 1
    ts_current <- diff(ts_current)
    adf_result <- adf.test(ts_current)
  }
  return(list(differencing = d, ts_final = ts_current, adf_result = adf_result))
}
```

## 5. Automatically Determine Differencing for Male and Female Series
```{r}
male_auto <- auto_diff_adf(male_ts)
female_auto <- auto_diff_adf(female_ts)

cat("\nMale Series: Differencing Order =", male_auto$differencing, "\n")
print(male_auto$adf_result)

cat("\nFemale Series: Differencing Order =", female_auto$differencing, "\n")
print(female_auto$adf_result)
```

```{r}
par(mfrow = c(1,1))
plot(male_auto$ts_final, type = "l", col = "mediumaquamarine",
     xlab = "Year", ylab = "Differenced Average Vowel",
     main = "Differenced Male and Female Average Vowel Series",
     xlim = range(time(male_auto$ts_final), time(female_auto$ts_final)),
     ylim = range(c(male_auto$ts_final, female_auto$ts_final)))
lines(female_auto$ts_final, col = "purple2")
legend("topright", 
       legend = c(paste("Male (Diff Order =", male_auto$differencing, ")"),
                  paste("Female (Diff Order =", female_auto$differencing, ")")),
       col = c("mediumaquamarine", "purple2"), lty = 1)

```

## 6. Plot ACF and PACF to Determine Model Structure
```{r}
par(mfrow = c(2,2))
Acf(male_auto$ts_final, main = paste("ACF - Male (Diff Order =", male_auto$differencing, ")"))
Pacf(male_auto$ts_final, main = paste("PACF - Male (Diff Order =", male_auto$differencing, ")"))
Acf(female_auto$ts_final, main = paste("ACF - Female (Diff Order =", female_auto$differencing, ")"))
Pacf(female_auto$ts_final, main = paste("PACF - Female (Diff Order =", female_auto$differencing, ")"))
```

## 7. Fit ARIMA Models Using `auto.arima`
```{r}
male_model <- auto.arima(male_ts)
female_model <- auto.arima(female_ts)

cat("\nMale ARIMA Model:\n")
print(summary(male_model))
cat("\nFemale ARIMA Model:\n")
print(summary(female_model))
```

## 8. Forecast for the Next 10 Years and Plot Results
```{r}
male_forecast <- forecast(male_model, h = 10)
female_forecast <- forecast(female_model, h = 10)

par(mfrow = c(1,2))
plot(male_forecast, main = "Male ARIMA Forecast", xlab = "Year", ylab = "Average Vowel Count")
plot(female_forecast, main = "Female ARIMA Forecast", xlab = "Year", ylab = "Average Vowel Count")
```

